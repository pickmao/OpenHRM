# 组织架构管理前端实现计划

## 一、总体架构

### 现有菜单结构
- **组织机构**（`organization`）
  - 组织架构（`org-structure`）- 树形展示整个组织
  - 部门管理（`org-dept`）- 部门 CRUD 操作
  - 岗位管理（`org-position`）- 岗位管理（未来扩展）

### 后端 API 接口（已实现）
1. `GET /api/org/units/tree/` - 获取组织树
2. `GET /api/org/units/` - 获取部门列表
3. `GET /api/org/units/{id}/` - 获取部门详情
4. `POST /api/org/units/` - 新增部门
5. `PATCH /api/org/units/{id}/` - 更新部门
6. `DELETE /api/org/units/{id}/` - 删除部门
7. `POST /api/org/units/{id}/move/` - 移动部门
8. `POST /api/org/units/reorder/` - 部门排序
9. `GET /api/org/units/{id}/members/` - 获取部门成员
10. `POST /api/org/units/{id}/manager/` - 设置部门负责人
11. `POST /api/org/memberships/` - 添加成员
12. `DELETE /api/org/memberships/{id}/` - 移除成员
13. `GET /api/org/memberships/by_user/` - 查询用户归属

---

## 二、实现步骤（分阶段）

### 🎯 阶段一：基础架构搭建

#### 步骤 1：创建 API 调用模块
**文件**: `src/api/org.js`

**内容**:
- 封装所有部门管理 API
- 封装所有成员管理 API
- 使用统一的 request 工具

**预计时间**: 10分钟

---

#### 步骤 2：配置路由
**文件**: `src/router/index.js`

**新增路由**:
```javascript
{
  path: '/org',
  children: [
    { path: 'structure', name: 'OrgStructure', component: () => import('@/views/org/Structure.vue') },
    { path: 'department', name: 'OrgDepartment', component: () => import('@/views/org/Department.vue') }
  ]
}
```

**预计时间**: 5分钟

---

### 🎯 阶段二：组织架构页面（树形展示）

#### 步骤 3：创建组织架构页面组件
**文件**: `src/views/org/Structure.vue`

**功能需求**:
1. **树形展示组织架构**
   - 使用 Ant Design Vue 的 `a-tree` 组件
   - 支持展开/折叠
   - 支持搜索过滤
   - 显示部门类型图标

2. **部门详情面板**
   - 点击部门显示详细信息
   - 显示部门统计（成员数、下级部门数）
   - 显示部门负责人

3. **快速操作**
   - 新增子部门
   - 编辑部门
   - 删除部门
   - 设置负责人

**预计时间**: 30分钟

---

#### 步骤 4：实现拖拽排序功能
**功能**:
- 使用 `a-tree` 的拖拽功能
- 调用 `POST /api/org/units/{id}/move/` 接口
- 验证拖拽逻辑（不能拖到子部门下）

**预计时间**: 20分钟

---

### 🎯 阶段三：部门管理页面

#### 步骤 5：创建部门管理页面组件
**文件**: `src/views/org/Department.vue`

**功能需求**:

1. **部门列表（表格模式）**
   - 显示所有部门
   - 支持搜索、筛选
   - 支持分页
   - 显示父级部门、类型、状态

2. **新增/编辑部门表单**
   ```javascript
   {
     name: '',           // 部门名称
     code: '',           // 部门编码
     unit_type: '',      // 部门类型
     parent: null,       // 父部门（树选择）
     sort_order: 0,      // 排序
     is_active: true     // 启用状态
   }
   ```

3. **删除确认**
   - 检查是否有子部门
   - 检查是否有成员
   - 显示友好的错误提示

**预计时间**: 40分钟

---

### 🎯 阶段四：部门成员管理

#### 步骤 6：创建成员管理组件
**文件**: `src/components/org/MemberManager.vue`

**功能需求**:

1. **成员列表**
   - 显示部门所有成员
   - 显示主部门标识
   - 显示负责人标识
   - 支持搜索

2. **添加成员**
   - 选择用户
   - 设置职务
   - 设置是否主部门
   - 设置是否负责人

3. **移除成员**
   - 确认对话框
   - 记录操作日志

**预计时间**: 30分钟

---

#### 步骤 7：成员抽屉组件
**文件**: `src/components/org/MemberDrawer.vue`

**功能**:
- 在组织架构页面点击部门时显示
- 展示部门成员列表
- 快速添加/移除成员
- 显示成员详细信息

**预计时间**: 20分钟

---

### 🎯 阶段五：集成与优化

#### 步骤 8：更新 Dashboard 菜单跳转
**文件**: `src/views/Dashboard.vue`

**修改**:
- 更新 `handleMenuSelect` 中的路由映射
- 确保菜单项正确跳转

**预计时间**: 5分钟

---

#### 步骤 9：添加权限控制
**功能**:
- 根据用户角色显示/隐藏操作按钮
- 只有管理员可以编辑组织架构
- 普通用户只能查看

**预计时间**: 15分钟

---

#### 步骤 10：错误处理与优化
**功能**:
- 统一错误提示
- Loading 状态优化
- 空状态页面
- 操作成功/失败反馈

**预计时间**: 20分钟

---

## 三、文件结构

```
src/
├── api/
│   └── org.js                    # 组织架构 API
├── views/
│   └── org/
│       ├── Structure.vue         # 组织架构页面
│       └── Department.vue        # 部门管理页面
├── components/
│   └── org/
│       ├── MemberManager.vue     # 成员管理组件
│       ├── MemberDrawer.vue      # 成员抽屉组件
│       └── DepartmentForm.vue    # 部门表单组件
└── router/
    └── index.js                  # 路由配置
```

---

## 四、核心功能清单

### 组织架构页面（Structure.vue）
- [ ] 树形展示组织架构
- [ ] 搜索部门
- [ ] 点击查看部门详情
- [ ] 拖拽移动部门
- [ ] 新增子部门
- [ ] 编辑部门
- [ ] 删除部门
- [ ] 设置部门负责人
- [ ] 查看部门成员

### 部门管理页面（Department.vue）
- [ ] 部门列表（表格）
- [ ] 搜索/筛选部门
- [ ] 新增部门
- [ ] 编辑部门
- [ ] 删除部门
- [ ] 批量操作

### 成员管理（MemberManager.vue）
- [ ] 成员列表
- [ ] 添加成员
- [ ] 移除成员
- [ ] 设置负责人
- [ ] 设置主部门

---

## 五、预计总时间

| 阶段 | 步骤 | 预计时间 | 累计时间 |
|------|------|----------|----------|
| 阶段一 | API + 路由 | 15分钟 | 15分钟 |
| 阶段二 | 组织架构页面 | 50分钟 | 65分钟 |
| 阶段三 | 部门管理页面 | 40分钟 | 105分钟 |
| 阶段四 | 成员管理 | 50分钟 | 155分钟 |
| 阶段五 | 集成优化 | 40分钟 | 195分钟 |

**总计**: 约 3.5 小时

---

## 六、开发优先级

### P0（核心功能，必须实现）
1. API 调用模块
2. 组织架构树形展示
3. 部门列表
4. 部门 CRUD 操作

### P1（重要功能）
5. 部门成员管理
6. 拖拽排序
7. 路由集成

### P2（增强功能）
8. 权限控制
9. 高级搜索
10. 批量操作

---

## 七、技术要点

### 组件选择
- **树形组件**: `a-tree` (Ant Design Vue)
- **表格组件**: `a-table`
- **表单组件**: `a-form`, `a-modal`
- **抽屉组件**: `a-drawer`

### 状态管理
- 使用 Pinia stores 管理组织架构数据
- 缓存组织树数据，避免频繁请求

### 数据缓存策略
```javascript
// 缓存组织树
const orgTreeCache = ref(null)
const cacheTime = ref(0)

// 5分钟缓存
if (Date.now() - cacheTime.value > 5 * 60 * 1000) {
  // 重新获取
}
```

---

## 八、下一步行动

**是否开始实现？建议从阶段一开始：**

1. ✅ 创建 `src/api/org.js` - API 调用模块
2. ✅ 配置路由
3. ✅ 创建组织架构页面

请告诉我从哪个步骤开始，我会一步步帮你实现！
